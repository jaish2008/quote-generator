<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QuoteLab ‚Äî Advanced Quote Generator</title>
<meta name="color-scheme" content="light dark">
<style>
  :root{
    --w: 100vw; --h: 100vh;
    --card-w: 720px;
    --accent: #6a11cb;
    --glass: rgba(255,255,255,0.12);
    --glass-2: rgba(255,255,255,0.22);
    --text-light: #FFFFFF;
    --text-dark: #222;
  }

  /* base */
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(135deg,#fbc2eb 0%, #a6c1ee 100%);
    overflow:hidden;
  }

  /* particles canvas full-screen behind */
  #particles {
    position:fixed; inset:0; z-index:0; pointer-events:none;
  }

  /* main container */
  .wrap{
    position:relative;
    z-index:10;
    width: min(96%, var(--card-w));
    max-width:1000px;
    margin:20px;
    padding:22px;
    border-radius:18px;
    backdrop-filter: blur(12px) saturate(120%);
    background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(255,255,255,0.05));
    box-shadow: 0 12px 40px rgba(10,10,30,0.22);
    color:var(--text-light);
  }

  header.top {
    display:flex; gap:12px; align-items:center; justify-content:space-between;
    margin-bottom:12px;
  }
  .brand { display:flex; align-items:center; gap:12px; }
  .logo {
    width:48px; height:48px; border-radius:10px;
    background:linear-gradient(135deg,#ff9a9e,#a18cd1);
    display:flex; align-items:center; justify-content:center;
    font-weight:700; color:#fff; font-size:18px;
  }
  .title { font-size:20px; margin:0; color:var(--text-light); }

  .controls-row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }

  /* theme selector pills */
  .theme-pill { padding:8px 10px; border-radius:999px; cursor:pointer; border:1px solid rgba(255,255,255,0.08); background:rgba(255,255,255,0.03); color:var(--text-light); }

  /* main layout */
  .main {
    display:grid;
    grid-template-columns: 1fr 320px;
    gap:18px;
    align-items:start;
  }

  /* quote card */
  .card {
    background: linear-gradient(180deg, rgba(255,255,255,0.97), rgba(250,250,250,0.97));
    color:var(--text-dark);
    border-radius:14px;
    padding:20px;
    min-height:220px;
    position:relative;
    overflow:hidden;
  }

  .card .loader {
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:64px; height:64px;
    border-radius:50%;
    border:6px solid rgba(0,0,0,0.06);
    border-top-color: #6a11cb;
    box-shadow:0 8px 30px rgba(90,30,160,0.08);
    animation: spin 0.9s linear infinite;
    display:none;
  }
  @keyframes spin { to { transform: rotate(360deg) } }

  #quoteText { font-size:20px; line-height:1.5; margin:0; opacity:0; transform:translateY(8px); transition: all 400ms cubic-bezier(.2,.9,.2,1); }
  #quoteAuthor { margin-top:12px; text-align:right; font-style:italic; color:#444; opacity:0; transform:translateY(6px); transition: all 320ms ease; }

  /* small controls inside card */
  .card-actions { display:flex; gap:8px; margin-top:14px; flex-wrap:wrap; align-items:center; }

  /* right panel */
  .side {
    display:flex; flex-direction:column; gap:10px;
  }
  .panel {
    background:rgba(255,255,255,0.06);
    padding:12px; border-radius:12px;
    min-height:60px;
  }
  label{ font-size:13px; display:block; margin-bottom:6px; color:rgba(255,255,255,0.9); }

  select, input[type="range"] { width:100%; padding:8px; border-radius:8px; border:none; }

  /* buttons */
  .btn {
    padding:10px 14px; border-radius:12px; border:none; cursor:pointer; font-weight:700;
    background:linear-gradient(90deg,#6a11cb,#2575fc); color:white;
    box-shadow:0 8px 20px rgba(80,30,150,0.12);
    position:relative; overflow:hidden;
  }
  .btn.secondary { background:rgba(255,255,255,0.95); color:var(--accent); box-shadow:none; font-weight:600; }
  .btn.small { padding:8px 10px; font-size:13px; border-radius:8px; }

  /* ripple */
  .btn:after {
    content:""; position:absolute; border-radius:50%; transform:scale(0); opacity:0.6;
    background: radial-gradient(circle, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.0) 40%);
    width:120px; height:120px; left:50%; top:50%; pointer-events:none;
    transform:translate(-50%,-50%) scale(0);
    transition: transform 450ms cubic-bezier(.2,.9,.2,1), opacity 450ms;
  }

  .btn.ripple-active:after { transform:translate(-50%,-50%) scale(1); opacity:0; transition: transform 650ms cubic-bezier(.2,.9,.2,1), opacity 500ms; }

  /* favourites list */
  .fav-list { max-height:220px; overflow:auto; padding-right:6px; }
  .fav-item { padding:8px; border-radius:8px; margin-bottom:8px; background:rgba(255,255,255,0.05); display:flex; justify-content:space-between; gap:8px; align-items:center; }
  .small-muted { font-size:13px; color:rgba(255,255,255,0.85); }

  /* responsive */
  @media (max-width:900px){
    .main{ grid-template-columns:1fr; }
    .side{ order:2 }
  }

  /* dark mode (toggle via class) */
  .darkbody {
    background: linear-gradient(135deg,#091226 0%, #3b3b98 100%) !important;
  }
  .darkbody .wrap { background: linear-gradient(180deg, rgba(0,0,0,0.54), rgba(0,0,0,0.4)); color:var(--text-light); }
  .darkbody .card { background: linear-gradient(180deg, rgba(10,10,30,0.95), rgba(20,20,40,0.95)); color:var(--text-light); }
  .darkbody .panel { background: rgba(255,255,255,0.03) }
  .darkbody #quoteAuthor { color: rgba(255,255,255,0.78) }

  /* theme classes handled in JS - set background gradients */
  .theme-1 { background: linear-gradient(135deg,#ff9a9e,#fad0c4); }
  .theme-2 { background: linear-gradient(135deg,#a18cd1,#fbc2eb); }
  .theme-3 { background: linear-gradient(135deg,#f6d365,#fda085); }
  .theme-4 { background: linear-gradient(135deg,#84fab0,#8fd3f4); }

  /* tiny helpers */
  .row { display:flex; gap:8px; align-items:center; }
  .muted { color:rgba(255,255,255,0.85); font-size:14px }
</style>
</head>
<body id="pageBody">

<canvas id="particles"></canvas>

<div class="wrap" id="appWrap" role="application" aria-label="Quote Generator">
  <header class="top">
    <div class="brand">
      <div class="logo">QL</div>
      <div>
        <div class="title">QuoteLab</div>
        <div class="small-muted">Daily inspiration & moods ‚Äî offline-ready</div>
      </div>
    </div>

    <div class="controls-row">
      <div class="row">
        <button id="themeBtn" class="theme-pill" title="Change theme">Theme</button>
        <button id="darkToggle" class="theme-pill">Dark</button>
      </div>
    </div>
  </header>

  <div class="main">
    <!-- left: quote card -->
   <div>
      <div class="card" aria-live="polite">
        <div class="card-loader loader" id="bigLoader" style="display:none"></div>

        <p id="quoteText">Click <strong>New Quote</strong> to begin.</p>
        <div id="quoteAuthor"></div>

        <div class="card-actions">
          <button id="newBtn" class="btn" onclick="getQuote()">New Quote</button>
          <button id="copyBtn" class="btn secondary small">Copy</button>
          <button id="shareBtn" class="btn secondary small">Share</button>
          <button id="favBtn" class="btn small">‚ô° Save</button>
          <button id="downloadBtn" class="btn secondary small">Download</button>
          <button id="confettiBtn" class="btn small">Confetti</button>
        </div>

        <div style="margin-top:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
          <label style="color: #666; font-size:13px; margin-right:6px;">Mood:</label>
          <select id="moodSelect" style="padding:8px; border-radius:8px;">
            <option value="">Any</option>
            <option value="happy">üòä Happy</option>
            <option value="sad">üò¢ Sad</option>
            <option value="motivation">üí™ Motivation</option>
            <option value="love">‚ù§Ô∏è Love</option>
            <option value="stress">üòå Stress Relief</option>
          </select>

          <label style="margin-left:8px; color:#666; font-size:13px;">Auto-play:</label>
          <input id="autoToggle" type="checkbox" />

          <label style="margin-left:8px; color:#666; font-size:13px;">BG Music:</label>
          <input id="musicToggle" type="checkbox" />
        </div>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
        <button id="dailyBtn" class="btn small">Daily Quote</button>
        <button id="clearFavs" class="btn secondary small">Clear Favourites</button>
      </div>
    </div>

    <!-- right: side panels -->
    <div class="side">
      <div class="panel">
        <label>Themes</label>
        <div style="display:flex; gap:8px;">
          <button class="theme-pill" data-theme="1">Pink</button>
          <button class="theme-pill" data-theme="2">Lilac</button>
          <button class="theme-pill" data-theme="3">Sunset</button>
          <button class="theme-pill" data-theme="4">Aqua</button>
        </div>
      </div>

      <div class="panel">
        <label>Favourites</label>
        <div class="fav-list" id="favList">
          <div class="small-muted">No favourites yet ‚Äî save a quote to see it here.</div>
        </div>
      </div>

      <div class="panel">
        <label>Settings</label>
        <div style="display:flex; gap:8px; flex-direction:column;">
          <div class="row"><label class="muted">Auto-play interval (s)</label><input id="intervalRange" type="range" min="3" max="20" value="5" /></div>
          <div class="row"><label class="muted">Particle intensity</label><input id="intensityRange" type="range" min="10" max="80" value="28" /></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* -----------------------------
   Data: Offline quotes & moods
   ----------------------------- */
const quotes = [
  { text:"Believe you can and you're halfway there.", author:"Theodore Roosevelt", mood:"motivation" },
  { text:"Your limitation‚Äîit's only your imagination.", author:"k.jasons", mood:"motivation" },
  { text:"Push yourself, because no one else is going to do it for you.", author:"Unknown", mood:"motivation" },
  { text:"Great things never come from comfort zones.", author:"blier stein", mood:"motivation" },
  { text:"Dream it. Wish it. Do it.", author:"geins loran", mood:"happy" },
  { text:"Success doesn‚Äôt just find you. You find it.", author:"david styin", mood:"motivation" },
  { text:"The only way to do great work is to love what you do.", author:"Steve Jobs", mood:"motivation" },
  { text:"It always seems impossible until it‚Äôs done.", author:"Nelson Mandela", mood:"motivation" },
  { text:"Smile, and the world smiles with you.", author:"Stanley Gordon", mood:"happy" },
  { text:"Even the darkest night will end and the sun will rise.", author:"Victor Hugo", mood:"sad" },
  { text:"You are never too old to set another goal or to dream a new dream.", author:"C.S. Lewis", mood:"happy" },
  { text:"Start where you are. Use what you have. Do what you can.", author:"Arthur Ashe", mood:"motivation" },
  { text:"Turn your wounds into wisdom.", author:"Oprah Winfrey", mood:"motivation" },
  { text:"Where there is love, there is life.", author:"Mahatma Gandhi", mood:"love" },
  { text:"One breath at a time. You are doing fine.", author:"getbs clar", mood:"stress" },
  { text:"Relax. Nothing is under control ‚Äî and that‚Äôs okay.", author:"syndy sten", mood:"stress" },
  { text:"You are my today and all of my tomorrows.", author:"Leo Christopher", mood:"love" }
];

/* -----------------------------
   DOM refs
   ----------------------------- */
const pageBody = document.getElementById('pageBody');
const quoteText = document.getElementById('quoteText');
const quoteAuthor = document.getElementById('quoteAuthor');
const newBtn = document.getElementById('newBtn');
const copyBtn = document.getElementById('copyBtn');
const shareBtn = document.getElementById('shareBtn');
const favBtn = document.getElementById('favBtn');
const downloadBtn = document.getElementById('downloadBtn');
const confettiBtn = document.getElementById('confettiBtn');
const moodSelect = document.getElementById('moodSelect');
const autoToggle = document.getElementById('autoToggle');
const musicToggle = document.getElementById('musicToggle');
const dailyBtn = document.getElementById('dailyBtn');
const favListEl = document.getElementById('favList');
const themeButtons = document.querySelectorAll('[data-theme]');
const themeBtn = document.getElementById('themeBtn');
const darkToggle = document.getElementById('darkToggle');
const bigLoader = document.getElementById('bigLoader');
const intervalRange = document.getElementById('intervalRange');
const intensityRange = document.getElementById('intensityRange');
const clearFavsBtn = document.getElementById('clearFavs');

/* -----------------------------
   State
   ----------------------------- */
let currentQuote = null;
let autoTimer = null;
let themeIndex = 1;
let isDark = false;

/* -----------------------------
   Audio (WebAudio soft tap + bell + ambient)
   ----------------------------- */
function playSoftTap(){
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = "sine";
    o.frequency.setValueAtTime(880, ctx.currentTime);
    o.frequency.exponentialRampToValueAtTime(420, ctx.currentTime + 0.07);
    g.gain.setValueAtTime(0.001, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.4, ctx.currentTime + 0.02);
    g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.12);
    o.connect(g); g.connect(ctx.destination);
    o.start();
    o.stop(ctx.currentTime + 0.14);
  } catch(e){ console.warn('Audio blocked'); }
}

function playSoftBell(){
  try {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const t0 = ctx.currentTime;
    const g = ctx.createGain();
    g.gain.setValueAtTime(0.0001, t0);
    g.gain.exponentialRampToValueAtTime(0.6, t0 + 0.02);
    g.gain.exponentialRampToValueAtTime(0.001, t0 + 1.4);

    const o1 = ctx.createOscillator();
    o1.type = 'sine';
    o1.frequency.setValueAtTime(880, t0);
    o1.frequency.exponentialRampToValueAtTime(440, t0 + 1.2);

    const o2 = ctx.createOscillator();
    o2.type = 'triangle';
    o2.frequency.setValueAtTime(1320, t0);
    o2.frequency.exponentialRampToValueAtTime(660, t0 + 1.2);
    o2.detune.value = 10;

    const re = ctx.createBiquadFilter();
    re.type = 'lowpass';
    re.frequency.value = 2200;

    o1.connect(re); o2.connect(re); re.connect(g); g.connect(ctx.destination);
    o1.start(t0); o2.start(t0);
    o1.stop(t0 + 1.2); o2.stop(t0 + 1.2);
  } catch(e){ console.warn('Bell blocked'); }
}

// Ambient music (simple gentle loop using Audio with a royalty-free ambient sample URL fallback)
let ambientAudio = null;
function ensureAmbient(){
  if(ambientAudio) return;
  ambientAudio = new Audio('https://cdn.pixabay.com/download/audio/2022/03/18/audio_0c9a1c4f8a.mp3?filename=smooth-ambient-11178.mp3');
  ambientAudio.loop = true;
  ambientAudio.volume = 0.15;
}

/* -----------------------------
   UI helpers: ripple
   ----------------------------- */
function addRipple(btn){
  btn.addEventListener('pointerdown', (e)=>{
    btn.classList.add('ripple-active');
    setTimeout(()=> btn.classList.remove('ripple-active'), 600);
  });
}
document.querySelectorAll('.btn').forEach(addRipple);

/* -----------------------------
   Loader + display logic
   ----------------------------- */
function showLoader(show=true){
  bigLoader.style.display = show ? 'block' : 'none';
}
function animateIn(){
  quoteText.style.opacity = 1;
  quoteText.style.transform = 'translateY(0)';
  quoteAuthor.style.opacity = 1;
  quoteAuthor.style.transform = 'translateY(0)';
}
function animateOut(){
  quoteText.style.opacity = 0;
  quoteText.style.transform = 'translateY(8px)';
  quoteAuthor.style.opacity = 0;
  quoteAuthor.style.transform = 'translateY(6px)';
}

/* -----------------------------
   Quote operations
   ----------------------------- */
function pickRandom(mood=''){
  let pool = quotes;
  if(mood){
    pool = quotes.filter(q=> q.mood === mood);
    if(pool.length === 0) pool = quotes;
  }
  return pool[Math.floor(Math.random()*pool.length)];
}
async function getQuote() {
    const url = "https://api.quotable.io/random"; // REAL API
    const response = await fetch(url);
    const data = await response.json();

    document.getElementById("quote").innerText = data.content;
    document.getElementById("author").innerText = "‚Äî " + data.author;
}

async function showQuote(qObj, {playBell=true, typewriter=true} = {}){
  if(!qObj) return;
  currentQuote = qObj;
  showLoader(true);
  animateOut();
  // small delay
  await new Promise(r=>setTimeout(r, 320));
  showLoader(false);
  if(playBell) playSoftTap();

  if(typewriter){
    // typewriter style
    quoteText.textContent = '';
    const txt = qObj.text;
    for(let i=0;i<txt.length;i++){
      quoteText.textContent += txt.charAt(i);
      await new Promise(r=>setTimeout(r, 12));
    }
  } else {
    quoteText.textContent = qObj.text;
  }
  quoteAuthor.textContent = '‚Äî ' + (qObj.author || 'Unknown');
  animateIn();
}

/* New quote handler */
async function handleNew(){
  const mood = moodSelect.value;
  const q = pickRandom(mood);
  await showQuote(q);
}

/* Auto-play */
function startAuto(){
  stopAuto();
  const sec = Number(intervalRange.value) || 5;
  autoTimer = setInterval(()=> {
    handleNew();
  }, sec * 1000);
}
function stopAuto(){
  if(autoTimer) { clearInterval(autoTimer); autoTimer = null; }
}

/* copy */
async function copyCurrent(){
  if(!currentQuote) return;
  try{
    await navigator.clipboard.writeText(`${currentQuote.text}\n${currentQuote.author ? '‚Äî '+currentQuote.author : ''}`);
    playSoftTap();
    copyBtn.textContent = 'Copied ‚úì';
    setTimeout(()=> copyBtn.textContent = 'Copy', 900);
  } catch(e){
    alert('Copy failed ‚Äî permission?');
  }
}

/* share (navigator.share fallback to WhatsApp) */
function shareCurrent(){
  if(!currentQuote) return;
  const text = `${currentQuote.text}\n${currentQuote.author ? '‚Äî '+currentQuote.author : ''}`;
  if(navigator.share){
    navigator.share({ text }).catch(()=> {});
  } else {
    const wa = `https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`;
    window.open(wa, '_blank');
  }
  playSoftTap();
}

/* favourites (localStorage) */
function loadFavs(){
  try {
    const raw = localStorage.getItem('ql_favs') || '[]';
    return JSON.parse(raw);
  } catch(e){ return []; }
}
function saveFavs(list){
  localStorage.setItem('ql_favs', JSON.stringify(list));
}
function addFav(){
  if(!currentQuote) return;
  const list = loadFavs();
  list.unshift(currentQuote);
  // unique by text
  const unique = [];
  const seen = new Set();
  for(const it of list){
    if(!seen.has(it.text)){ unique.push(it); seen.add(it.text); }
  }
  saveFavs(unique.slice(0,50));
  renderFavs();
  playSoftBell();
  favBtn.textContent = 'Saved ‚úì';
  setTimeout(()=> favBtn.textContent = '‚ô° Save', 900);
}
function clearFavs(){
  if(confirm('Clear all favourites?')){ saveFavs([]); renderFavs(); }
}
function renderFavs(){
  const list = loadFavs();
  favListEl.innerHTML = '';
  if(list.length === 0){
    favListEl.innerHTML = '<div class="small-muted">No favourites yet ‚Äî save a quote to see it here.</div>';
    return;
  }
  for(const it of list){
    const el = document.createElement('div');
    el.className = 'fav-item';
    el.innerHTML = `<div style="flex:1"><div style="font-size:14px;color:#fff">${it.text}</div><div style="font-size:12px;color:rgba(255,255,255,0.75);margin-top:6px">${it.author || ''}</div></div>
      <div style="display:flex;gap:6px;align-items:center">
        <button class="btn small" style="padding:6px 8px">Use</button>
        <button class="btn secondary small" style="padding:6px 8px">Del</button>
      </div>`;
    const [useBtn, delBtn] = el.querySelectorAll('button');
    useBtn.addEventListener('click', ()=> showQuote(it, {playBell:false, typewriter:false}));
    delBtn.addEventListener('click', ()=>{
      const filtered = loadFavs().filter(x=> x.text !== it.text);
      saveFavs(filtered);
      renderFavs();
    });
    favListEl.appendChild(el);
  }
}

/* download PNG */
function downloadImage(){
  if(!currentQuote) return;
  playSoftTap();
  const canvas = document.createElement('canvas');
  const w = 1000, h = 600;
  canvas.width = w; canvas.height = h;
  const ctx = canvas.getContext('2d');

  // background gradient (match current theme by reading body style)
  const t = getComputedStyle(document.body).backgroundImage;
  // fallback gradient
  const g = ctx.createLinearGradient(0,0,w,h);
  g.addColorStop(0,'#ff9a9e'); g.addColorStop(1,'#a18cd1');
  ctx.fillStyle = g; ctx.fillRect(0,0,w,h);

  // white card
  ctx.fillStyle = 'rgba(255,255,255,0.98)';
  roundRect(ctx, 60, 60, w-120, h-140, 20, true, false);

  // quote text
  ctx.fillStyle = '#222';
  ctx.font = '28px Georgia, serif';
  wrapText(ctx, currentQuote.text, 100, 160, w-200, 36);

  // author
  ctx.font = '22px Georgia, italic';
  ctx.textAlign = 'right';
  ctx.fillText(currentQuote.author || '', w-110, h-110);

  // download
  const url = canvas.toDataURL('image/png');
  const a = document.createElement('a');
  a.href = url; a.download = 'quote.png'; a.click();
}

/* helper: rounded rect & wrap text */
function roundRect(ctx, x, y, w, h, r, fill, stroke){
  ctx.beginPath();
  ctx.moveTo(x+r, y);
  ctx.arcTo(x+w,y, x+w,y+h, r);
  ctx.arcTo(x+w,y+h, x,y+h, r);
  ctx.arcTo(x,y+h, x,y, r);
  ctx.arcTo(x,y, x+w,y, r);
  ctx.closePath();
  if(fill) ctx.fill();
  if(stroke) ctx.stroke();
}
function wrapText(ctx, text, x, y, maxWidth, lineHeight){
  const words = text.split(' ');
  let line = '';
  for(let n=0;n<words.length;n++){
    const test = line + words[n] + ' ';
    const metrics = ctx.measureText(test);
    if(metrics.width > maxWidth && n > 0){
      ctx.fillText(line, x, y);
      line = words[n] + ' ';
      y += lineHeight;
    } else line = test;
  }
  ctx.fillText(line, x, y);
}

/* confetti */
function doConfetti(){
  const root = document.body;
  for(let i=0;i<24;i++){
    const el = document.createElement('div');
    const size = 8 + Math.random()*12;
    el.style.position='fixed';
    el.style.left = (40 + Math.random()*20) + '%';
    el.style.top = '20%';
    el.style.width = el.style.height = size + 'px';
    el.style.background = `hsl(${Math.random()*360} 70% 60%)`;
    el.style.zIndex = 99999;
    el.style.pointerEvents = 'none';
    el.style.borderRadius = '2px';
    document.body.appendChild(el);
    const dx = (Math.random()-0.5)*1200;
    const dy = 700 + Math.random()*300;
    el.animate([{ transform:'translateY(0) rotate(0)', opacity:1 }, { transform:`translate(${dx}px, ${dy}px) rotate(${Math.random()*540}deg)`, opacity:0 }], { duration: 1200 + Math.random()*900, easing:'cubic-bezier(.2,.9,.2,1)'});
    setTimeout(()=> el.remove(), 2100);
  }
}

/* Theme switching (changes page background) */
const themes = [
  'linear-gradient(135deg,#ff9a9e,#fad0c4)',
  'linear-gradient(135deg,#a18cd1,#fbc2eb)',
  'linear-gradient(135deg,#f6d365,#fda085)',
  'linear-gradient(135deg,#84fab0,#8fd3f4)'
];
function applyTheme(i){
  const bg = themes[(i-1) % themes.length];
  document.body.style.background = bg;
  themeIndex = i;
}

/* particles canvas */
const pc = document.getElementById('particles');
const ctx = pc.getContext('2d');
let particles = [];
function resizeCanvas(){
  pc.width = innerWidth;
  pc.height = innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function initParticles(count){
  particles = [];
  for(let i=0;i<count;i++){
    particles.push({
      x: Math.random()*pc.width,
      y: Math.random()*pc.height,
      r: 0.5 + Math.random()*2.2,
      vx: (Math.random()-0.5) * 0.25,
      vy: (Math.random()-0.5) * 0.6,
      alpha: 0.3 + Math.random()*0.7
    });
  }
}
function animateParticles(){
  ctx.clearRect(0,0,pc.width, pc.height);
  for(const p of particles){
    p.x += p.vx; p.y += p.vy;
    if(p.x < -10) p.x = pc.width + 10;
    if(p.x > pc.width + 10) p.x = -10;
    if(p.y < -10) p.y = pc.height + 10;
    if(p.y > pc.height + 10) p.y = -10;
    ctx.beginPath();
    ctx.fillStyle = `rgba(255,255,255,${p.alpha*0.09})`;
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fill();
  }
  requestAnimationFrame(animateParticles);
}

/* -----------------------------
   Daily quote: store per day
   ----------------------------- */
function getDayKey(){
  const d = new Date();
  return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
}
function setDailyQuote(q){
  localStorage.setItem('ql_daily', JSON.stringify({ key: getDayKey(), quote: q }));
}
function getDailyQuote(){
  try {
    const raw = localStorage.getItem('ql_daily');
    if(!raw) return null;
    const obj = JSON.parse(raw);
    if(obj.key === getDayKey()) return obj.quote;
    return null;
  } catch(e){ return null; }
}

/* -----------------------------
   Init: attach events
   ----------------------------- */
newBtn.addEventListener('click', async ()=>{
  addRippleEffect(newBtn);
  await handleNew();
});

copyBtn.addEventListener('click', async ()=>{
  addRippleEffect(copyBtn);
  await copyCurrent();
});

shareBtn.addEventListener('click', ()=>{
  addRippleEffect(shareBtn);
  shareCurrent();
});

favBtn.addEventListener('click', ()=>{
  addRippleEffect(favBtn);
  addFav();
});

downloadBtn.addEventListener('click', ()=>{
  addRippleEffect(downloadBtn);
  downloadImage();
});

confettiBtn.addEventListener('click', ()=>{
  addRippleEffect(confettiBtn);
  doConfetti();
});

moodSelect.addEventListener('change', ()=> { playSoftTap(); });

autoToggle.addEventListener('change', (e)=>{
  if(e.target.checked) startAuto(); else stopAuto();
});

intervalRange.addEventListener('change', ()=>{
  if(autoTimer) startAuto();
});

musicToggle.addEventListener('change', (e)=>{
  if(e.target.checked){
    ensureAmbient();
    ambientAudio.play().catch(()=>{ /* auto-play blocked until user gesture */ });
  } else {
    if(ambientAudio) ambientAudio.pause();
  }
});

themeButtons.forEach(btn => {
  btn.addEventListener('click', ()=> {
    const i = Number(btn.dataset.theme);
    applyTheme(i);
    playSoftTap();
  });
});

themeBtn.addEventListener('click', ()=> {
  themeIndex = (themeIndex % themes.length) + 1;
  applyTheme(themeIndex);
  playSoftTap();
});

darkToggle.addEventListener('click', ()=>{
  isDark = !isDark;
  if(isDark) { document.body.classList.add('darkbody'); darkToggle.textContent = 'Light'; }
  else { document.body.classList.remove('darkbody'); darkToggle.textContent = 'Dark'; }
  playSoftTap();
});

dailyBtn.addEventListener('click', ()=>{
  const existing = getDailyQuote();
  if(existing){
    showQuote(existing, {playBell:false, typewriter:false});
    alert('Showing today\'s saved quote');
    return;
  }
  // pick and save today's
  const q = pickRandom();
  setDailyQuote(q);
  showQuote(q);
  playSoftBell();
});

clearFavsBtn.addEventListener('click', ()=>{
  clearFavs();
});

/* small helper to create ripple visual quickly */
function addRippleEffect(el){
  el.classList.add('ripple-active');
  setTimeout(()=> el.classList.remove('ripple-active'), 700);
}

/* start */
(function init(){
  applyTheme(1);
  initParticles(Number(intensityRange.value));
  animateParticles();
  renderFavs();
  // show daily if exists else neutral first
  const daily = getDailyQuote();
  if(daily) showQuote(daily, {playBell:false, typewriter:false});
  else showQuote({ text:'Click New Quote to start ‚Äî or pick a mood.' , author:'' }, {playBell:false, typewriter:false});
})();

/* listen to intensity range */
intensityRange.addEventListener('input', ()=>{
  initParticles(Number(intensityRange.value));
});

/* utility: allow pressing Enter on New button */
newBtn.addEventListener('keyup', (e)=> { if(e.key === 'Enter') newBtn.click(); });

</script>
</body>
</html>